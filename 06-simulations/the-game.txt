 1. Why simulations?
 2. Simulating the CLT
 3. Normal plots

 ***

  Често бихме желали да симулираме разни работи с R. Днес ще се научим да
  правим точно това. Като за начало ще започнем с централната гранична теорема
  (Central Limit Theorem). Тя гласи, че при определени условия, средното
  аритметично на голям брой независими случайни величини ще бъде приблизително
  нормално разпределено, независимо от разпределението на тези случайни
  величини. Естествено, тези случайни величини трябва да има дефинирано
  математическо очакване и стандартно отклонение.

  Математически изразено, ако имаме наблюденията Xi взети от популация със
  знайни математическо очакване (mu) и стандартно отклонение (sd), то
  стандартизираното средно:

                           mean(X) - mu
                          --------------
                           sd / sqrt(n)

  E приблизително нормално разпределено със средно mu и стандартно отклонение
  sd.

  Първият въпрос, на който трябва да си отговорим е - Какво представлява
  нормалното разпределение? Ами, то е непрекъснато разпределение, което е
  характерно за голям набор от случайни събития. Формата му е камбановидна и
  симетрична относно математическото очакване.

  Един вид, централната гранична теорема ни позволява да свеждаме
  математическите очаквания на голям брой независими случайни величини до
  нормално разпределение.

  Първата симулация, която ще направим, е свързана с биномно разпределение.
  Имаме n биномно разпределени случайни величини и искаме да апроксимираме
  сумата им чрез нормално разпределение. Ако S е биномна разпределена,
  нейното математическо очакване mu е равно на n*p, а стандартното ѝ
  отклонение sd е равно на n*p*q. Тогава, от по-горната формула следва, че
  случайната величина, която апроксимира математическото очакване на тези
  случайни величини, е нормално разпределена и се изчислява чрез следната
  формула:

                            S - n*p
                          -----------
                          sqrt(n*p*(1-p))

  Сега, нека симулираме това в R, за S биномно разпределена случайна величина
  с n=10 и p=0.25:

    > n=10; p=0.25
    > S = rbinom(1000, n, p) # Генерираме 1000 независими, биномно
    + разпределени случайни величини
    > X = (S - n*p) / sqrt(n*p*(1-p))

  Единственото, което ни остава е да нарисуваме разпределението им за да видим
  доколко то прилича на нормално разпределение:
  
    > hist(X, prob=T, col="cadetblue3")
    > curve(dnorm(x), add=T)

  Виждаме, че получената хистограма доста се приближава до теоретичната
  плътност на нормалното разпределение.

  Едно от приложенията на централната гранична теорема е апроксимирането на
  оценки за дадена извадка от популация. Имаме следния проблем - знаем, че
  продължителността на болестта на Алцхаймер от първите симптоми до смъртта е
  от 3 до 20 години; със средно 8 години и стандартно отклонение 4 години.
  Управител на голяма болница избира на случаен принцип медицинските картони
  на 30 починали от Алцхаймер пациенти. Той се пита каква е вероятността, че
  средната продължителност на пациент болен от Алцхаймер ще бъде по-малка от 7
  години.

  В тази задача знаем, че средната продължителност на живота на пациент болен
  от Алцхаймер е 8 години със стандартно отклонение 4 години. Това е валидно
  за цялата популация. Имайки тази информация, искаме да си направим
  заключение за извадка от тази популация - 30-те починали пациенти в
  болницата.

  Когато използваме централна гранична теорема за приближение на средно на
  дадена популация, трябва да се запитаме колко близки до нормалното
  разпределение са нашите данни. В случая виждаме, че данните са килнати
  наляво - голям брой пациенти живеят малко на брой години след настъпването
  на болестта. Следователно ще ни трябват повече хора за да е вярно
  заключението ни. В случая имаме 30 пациента - това е достатъчно количество.
  Ако данните ни бяха нормално разпределени, или симетрични, щяха да ни
  трябват много по-малко количество пациенти.

  Вторият въпрос, на който трябва да си отговорим преди да решим задачата, е
  до колко нашите заключения се отнасят до голямо количество от болници в
  страната. Тоест, ако тази болница е представителна за останалите лечебни
  заведения в страната, ние бихме могли да сме по-уверени в заключението си
  какъв процент от болните от Алцхаймер живеят по-малко от 7 години. Иначе,
  бихме могли да си направим заключение само за нашата болница.

  И така, след като определихме тия въпроси, вече можем да решим задачата. За
  целта, първо трябва да изчислим стандартизираното средно:

                          mean(X) - mu
                      z = ------------
                          sd / sqrt(n)

  С X сме означили извадката от пациентите починали от Алцхаймер в тази
  болница. Чудим се каква е вероятността пациентите да живеят средно по-малко
  от 7 години. Тази вероятност отговаря на площта на стандартната нормална
  крива наляво от z, където z е оценката на извадъчното средно спрямо 
  популационното средно - директно приложение на ЦГТ. В случая, z го
  изчисляваме и се оказва, че е -1.37. Значи, 
  
                P(mean(x) < 7) = P(z < -1.37) = 0.0853

  Тоест, вероятността пациент болен от Алцхаймер да живее по-малко от 7 години
  е 0.0853.
